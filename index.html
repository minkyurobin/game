<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>클래시 로얄 코인 RPG</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bangers&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Bangers', cursive;
        }

        body {
            background: url('https://clashroyale.com/images/backgrounds/arena.jpg') no-repeat center/cover fixed;
            min-height: 100vh;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        /* Nickname Screen */
        .nickname-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .nickname-container {
            background: linear-gradient(145deg, #1e3a5f, #2c5282);
            border: 4px solid #ffd700;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
            max-width: 350px;
            width: 90%;
        }

        .game-logo {
            font-size: 2.2em;
            color: #ffd700;
            text-shadow: 0 0 8px #ff6b35;
            margin-bottom: 10px;
        }

        .game-subtitle {
            font-size: 1em;
            color: #e0e7ff;
            margin-bottom: 15px;
        }

        .nickname-input {
            width: 100%;
            padding: 10px;
            font-size: 14px;
            border: 3px solid #3498db;
            border-radius: 8px;
            background: #fff;
            color: #2c3e50;
            text-align: center;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }

        .nickname-input:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 8px #ffd700;
        }

        .start-btn {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            border: none;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(247, 147, 30, 0.5);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .start-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(247, 147, 30, 0.7);
        }

        /* Top Header */
        .top-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(180deg, #1e3a5f, #2c5282);
            padding: 8px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            border-bottom: 3px solid #ffd700;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .player-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            border: 3px solid #ffd700;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }

        .player-details h3 {
            font-size: 1em;
            color: #ffd700;
        }

        .player-title {
            font-size: 0.8em;
            color: #bdc3c7;
        }

        .resources {
            display: flex;
            gap: 8px;
        }

        .resource-item {
            background: linear-gradient(45deg, #8e44ad, #9b59b6);
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 0.8em;
            border: 2px solid #fff3;
        }

        .resource-icon {
            font-size: 1em;
        }

        /* Game Container */
        .game-container {
            margin-top: 70px;
            padding: 10px;
            max-width: 900px;
            width: 100%;
        }

        /* Card Styles */
        .game-card {
            background: linear-gradient(145deg, #2c5282, #1e3a5f);
            border: 3px solid #ffd700;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s;
        }

        .game-card:hover {
            transform: translateY(-2px);
        }

        .card-title {
            font-size: 1.3em;
            color: #ffd700;
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 0 0 5px #ff6b35;
        }

        /* Character Panel */
        .character-section {
            text-align: center;
        }

        .character-avatar-large {
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            border: 4px solid #ffd700;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            margin: 0 auto 15px;
        }

        .level-display {
            background: linear-gradient(45deg, #3498db, #2980b9);
            border-radius: 8px;
            padding: 8px;
            margin-bottom: 10px;
            border: 2px solid #ffd700;
        }

        .level-text {
            font-size: 1em;
            font-weight: 400;
        }

        .progress-bar {
            background: #2c3e50;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            border: 1px solid #fff3;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            transition: width 0.5s ease;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .stat-item {
            background: #2c5282;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #fff3;
        }

        .stat-icon {
            font-size: 1.2em;
        }

        .stat-value {
            font-size: 1em;
            color: #ffd700;
        }

        /* Action Panel */
        .deed-input-section {
            margin-bottom: 10px;
        }

        .deed-input-container {
            display: flex;
            gap: 8px;
        }

        .deed-input {
            flex: 1;
            padding: 8px;
            font-size: 13px;
            border: 2px solid #3498db;
            border-radius: 6px;
            background: #fff;
            color: #2c3e50;
        }

        .deed-input:focus {
            outline: none;
            border-color: #ffd700;
        }

        .cr-button {
            padding: 8px 12px;
            font-size: 13px;
            border: none;
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .cr-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.5);
        }

        .btn-record { background: linear-gradient(45deg, #27ae60, #2ecc71); }
        .btn-battle { background: linear-gradient(45deg, #e74c3c, #c0392b); }
        .btn-shop { background: linear-gradient(45deg, #f39c12, #e67e22); }
        .btn-ranking { background: linear-gradient(45deg, #9b59b6, #8e44ad); }
        .btn-stats { background: linear-gradient(45deg, #34495e, #2c3e50); }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        /* Battle Arena */
        .battle-arena {
            text-align: center;
            padding: 15px;
        }

        .arena-enemy {
            font-size: 4em;
            margin: 15px 0;
        }

        .arena-description {
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        /* Game Log */
        .game-log {
            background: #2c3e50;
            border-radius: 8px;
            padding: 10px;
            max-height: 150px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.8em;
        }

        .log-entry {
            padding: 4px 8px;
            margin-bottom: 4px;
            border-radius: 4px;
            border-left: 2px solid;
        }

        .log-success { border-left-color: #2ecc71; color: #2ecc71; }
        .log-error { border-left-color: #e74c3c; color: #e74c3c; }
        .log-warning { border-left-color: #f39c12; color: #f39c12; }
        .log-info { border-left-color: #3498db; color: #3498db; }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .modal-content {
            background: linear-gradient(145deg, #2c5282, #1e3a5f);
            border: 3px solid #ffd700;
            border-radius: 12px;
            padding: 15px;
            max-width: 300px;
            width: 90%;
            text-align: center;
        }

        .modal-content h2 {
            color: #ffd700;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .modal-content ul {
            list-style: none;
            padding: 0;
            font-size: 0.9em;
        }

        .modal-content li {
            margin: 8px 0;
        }

        .modal-content button {
            padding: 8px 12px;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            border: none;
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
        }

        .modal-content button:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .game-container { padding: 8px; }
            .stats-grid { grid-template-columns: 1fr; }
            .button-grid { grid-template-columns: 1fr; }
            .deed-input-container { flex-direction: column; }
            .resources { flex-direction: column; gap: 6px; }
            .nickname-container { padding: 20px; max-width: 300px; }
            .game-logo { font-size: 1.8em; }
            .modal-content { max-width: 250px; }
        }
    </style>
</head>
<body>
    <!-- Nickname Screen -->
    <div class="nickname-screen" id="nickname-screen">
        <div class="nickname-container">
            <div class="game-logo">⚔️ 코인 RPG</div>
            <div class="game-subtitle">클래시 로얄 에디션</div>
            <input type="text" class="nickname-input" id="nickname-input" placeholder="닉네임 (3-12자)" maxlength="12" aria-label="닉네임 입력">
            <button class="start-btn" onclick="startGame()" aria-label="게임 시작">게임 시작</button>
        </div>
    </div>

    <!-- Top Header -->
    <div class="top-header" id="top-header" style="display: none;">
        <div class="player-info">
            <div class="player-avatar" id="player-avatar">👑</div>
            <div class="player-details">
                <h3 id="player-name">플레이어</h3>
                <div class="player-title" id="player-title">초보 모험가</div>
            </div>
        </div>
        <div class="resources">
            <div class="resource-item">
                <span class="resource-icon">💰</span>
                <span id="header-coins">10</span>
            </div>
            <div class="resource-item">
                <span class="resource-icon">💎</span>
                <span id="header-score">0</span>
            </div>
            <div class="resource-item">
                <span class="resource-icon">⚡</span>
                <span id="header-level">1</span>
            </div>
        </div>
    </div>

    <!-- Game Container -->
    <div class="game-container" id="game-container" style="display: none;">
        <!-- Character Panel -->
        <div class="game-card">
            <div class="card-title">🏛️ 캐릭터</div>
            <div class="character-section">
                <div class="character-avatar-large" id="character-avatar">👑</div>
                <div class="level-display">
                    <div class="level-text">레벨 <span id="level">1</span> - <span id="level-title">초보 모험가</span></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="exp-fill" style="width: 0%"></div>
                    </div>
                    <div style="margin-top: 5px; font-size: 0.8em;">EXP: <span id="exp">0</span>/100</div>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-icon">❤️</div>
                        <div>체력</div>
                        <div class="stat-value"><span id="current-hp">30</span>/<span id="max-hp">30</span></div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">💰</div>
                        <div>코인</div>
                        <div class="stat-value" id="coins">10</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">💎</div>
                        <div>총점</div>
                        <div class="stat-value" id="total-score">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">📝</div>
                        <div>기록</div>
                        <div class="stat-value" id="deeds-count">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Panel -->
        <div class="game-card">
            <div class="card-title">✅ 잘한 일</div>
            <div class="deed-input-section">
                <div class="deed-input-container">
                    <input type="text" class="deed-input" id="good-deed" placeholder="잘한 일 입력" aria-label="잘한 일 입력">
                    <button class="cr-button btn-record" onclick="recordGoodDeed()" aria-label="기록">기록</button>
                </div>
                <div style="font-size: 11px; opacity: 0.8; text-align: center; margin-top: 8px;">
                    💡 운동, 공부, 도움 키워드 보너스!
                </div>
            </div>
            <div class="button-grid">
                <button class="cr-button btn-battle" onclick="startBattle()" aria-label="던전">⚔️ 던전</button>
                <button class="cr-button btn-shop" onclick="showShop()" aria-label="상점">🏪 상점</button>
                <button class="cr-button btn-ranking" onclick="showRanking()" aria-label="랭킹">🏆 랭킹</button>
                <button class="cr-button btn-stats" onclick="showStats()" aria-label="통계">📊 통계</button>
            </div>
        </div>

        <!-- Battle Arena -->
        <div class="game-card">
            <div class="card-title">⚔️ 아레나</div>
            <div class="battle-arena">
                <div class="arena-enemy">🏰</div>
                <div class="arena-description">던전에서 보물을 획득!</div>
                <button class="cr-button btn-battle" onclick="startBattle()" aria-label="전투">⚔️ 전투</button>
            </div>
        </div>

        <!-- Game Log -->
        <div class="game-card">
            <div class="card-title">📜 로그</div>
            <div class="game-log" id="game-log">
                <div class="log-entry log-info">🎉 클래시 로얄 코인 RPG!</div>
                <div class="log-entry log-success">💰 10코인 획득!</div>
            </div>
        </div>
    </div>

    <script>
        let playerName = '';
        let gameState = {
            level: 1,
            exp: 0,
            maxHp: 30,
            currentHp: 30,
            coins: 10,
            totalScore: 0,
            deedsRecorded: 0,
            playerName: ''
        };
        let logs = [];
        let battleTimer = null;
        let isLuckyCharmActive = false;
        let coinBoostEndTime = 0;
        let attackBoost = 0;

        const levelTitles = {
            1: "초보 모험가", 3: "견습 전사", 5: "용감한 기사",
            8: "숙련된 전사", 12: "베테랑 용사", 15: "정예 챔피언",
            20: "전설의 영웅", 25: "마스터 워리어", 30: "얼티밋 레전드"
        };

        document.addEventListener('DOMContentLoaded', () => {
            // Always show nickname screen on load, even with saved state
            document.getElementById('nickname-screen').style.display = 'flex';
            document.getElementById('top-header').style.display = 'none';
            document.getElementById('game-container').style.display = 'none';

            const savedState = localStorage.getItem('gameState');
            if (savedState) {
                gameState = JSON.parse(savedState);
                playerName = gameState.playerName || '';
                if (playerName) {
                    document.getElementById('nickname-input').value = playerName;
                }
            }

            document.getElementById('nickname-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') startGame();
            });

            document.getElementById('good-deed').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') recordGoodDeed();
            });
        });

        function startGame() {
            const nickname = document.getElementById('nickname-input').value.trim();
            if (!nickname) {
                showModal('닉네임을 입력해주세요!', 'error');
                return;
            }
            if (nickname.length < 3) {
                showModal('닉네임을 더 길게 입력해주세요! (3-12자)', 'error');
                return;
            }
            if (nickname.length > 12) {
                showModal('닉네임은 12자를 초과할 수 없습니다!', 'error');
                return;
            }

            playerName = nickname;
            gameState.playerName = playerName;
            document.getElementById('nickname-screen').style.display = 'none';
            document.getElementById('top-header').style.display = 'flex';
            document.getElementById('game-container').style.display = 'block';
            updateAllDisplays();
            saveGameState();
            log(`🎉 ${playerName}님, 모험 시작!`, 'success');
        }

        function recordGoodDeed() {
            const input = document.getElementById('good-deed');
            const deed = input.value.trim();
            if (!deed) {
                log('잘한 일을 입력해주세요!', 'error');
                return;
            }

            let baseCoins = 15;
            let bonusCoins = 0;
            const bonusKeywords = {
                운동: ['운동', '조깅', '달리기', '헬스', '요가', '수영', '산책'],
                공부: ['공부', '독서', '학습', '강의', '시험', '과제', '책'],
                도움: ['도움', '봉사', '기부', '친절', '배려', '청소', '설거지']
            };

            let bonusCategories = [];
            for (const [category, words] of Object.entries(bonusKeywords)) {
                for (const word of words) {
                    if (deed.includes(word)) {
                        bonusCoins += 10;
                        bonusCategories.push(category);
                        break;
                    }
                }
            }

            let totalCoins = baseCoins + bonusCoins;
            if (coinBoostEndTime > Date.now()) {
                totalCoins *= 2;
                log('💎 코인 2배!', 'warning');
            }

            const earnedExp = Math.floor(totalCoins / 3);
            gameState.coins += totalCoins;
            gameState.exp += earnedExp;
            gameState.deedsRecorded++;
            gameState.totalScore += totalCoins * 2;

            if (gameState.exp >= 100) levelUp();

            log(`📝 "${deed}" 기록`, 'success');
            log(`💰 +${totalCoins}코인, ✨ +${earnedExp}EXP`, 'info');
            if (bonusCategories.length) log(`🎉 ${bonusCategories.join(', ')} 보너스`, 'warning');

            input.value = '';
            updateAllDisplays();
            saveGameState();
        }

        function levelUp() {
            const levelsGained = Math.floor(gameState.exp / 100);
            gameState.level += levelsGained;
            gameState.exp %= 100;
            const hpIncrease = levelsGained * 8;
            gameState.maxHp += hpIncrease;
            gameState.currentHp = gameState.maxHp;

            log(`🎉 레벨 ${gameState.level}!`, 'success');
            log(`❤️ HP +${hpIncrease}`, 'info');

            const levelBonus = levelsGained * 25;
            gameState.coins += levelBonus;
            gameState.totalScore += levelBonus * 3;
            log(`💰 +${levelBonus}코인`, 'warning');

            updateAllDisplays();
            saveGameState();
        }

        function startBattle() {
            if (battleTimer) clearTimeout(battleTimer);

            const enemies = [
                { name: '고블린', emoji: '👹', minDamage: 5, maxDamage: 12, minReward: 8, maxReward: 18 },
                { name: '오크', emoji: '🧌', minDamage: 8, maxDamage: 15, minReward: 12, maxReward: 25 },
                { name: '스켈레톤', emoji: '💀', minDamage: 3, maxDamage: 10, minReward: 5, maxReward: 15 },
                { name: '드래곤', emoji: '🐲', minDamage: 15, maxDamage: 25, minReward: 30, maxReward: 50 },
                { name: '마법사', emoji: '🧙‍♂️', minDamage: 10, maxDamage: 20, minReward: 20, maxReward: 35 }
            ];

            const enemy = enemies[Math.floor(Math.random() * enemies.length)];
            const baseDamage = Math.floor(Math.random() * (enemy.maxDamage - enemy.minDamage + 1)) + enemy.minDamage;
            const damage = Math.max(0, baseDamage - attackBoost);
            let coinReward = Math.floor(Math.random() * (enemy.maxReward - enemy.minReward + 1)) + enemy.minReward;
            const expReward = Math.floor(coinReward / 2);

            if (coinBoostEndTime > Date.now()) coinReward *= 2;

            log(`⚔️ ${enemy.emoji} ${enemy.name} 전투`, 'warning');

            battleTimer = setTimeout(() => {
                const win = isLuckyCharmActive || Math.random() > 0.2;
                if (win) {
                    log(`💥 ${enemy.name} 격파!`, 'success');
                    log(`🏆 +${coinReward}코인, +${expReward}EXP`, 'success');
                    gameState.coins += coinReward;
                    gameState.exp += expReward;
                    gameState.totalScore += coinReward * 3;
                    if (gameState.exp >= 100) levelUp();
                } else {
                    const lostHp = Math.floor(Math.random() * 10) + 5;
                    gameState.currentHp = Math.max(0, gameState.currentHp - lostHp);
                    log(`💔 ${enemy.name} 패배, HP -${lostHp}`, 'error');
                    if (gameState.currentHp <= 0) {
                        log(`😵 체력 소진! 5초 후 부활`, 'error');
                        battleTimer = setTimeout(() => {
                            gameState.currentHp = Math.floor(gameState.maxHp * 0.5);
                            log(`🌟 부활! HP 회복`, 'info');
                            updateAllDisplays();
                            saveGameState();
                        }, 5000);
                    }
                }

                if (isLuckyCharmActive) {
                    isLuckyCharmActive = false;
                    log('🍀 행운의 부적 종료', 'info');
                }

                updateAllDisplays();
                saveGameState();
                battleTimer = null;
            }, 1500);
        }

        function showShop() {
            const shopItems = [
                { name: '체력 물약', price: 30, emoji: '🧪', effect: 'HP +15' },
                { name: '경험치 물약', price: 50, emoji: '✨', effect: 'EXP +25' },
                { name: '행운의 부적', price: 100, emoji: '🍀', effect: '다음 전투 승리' },
                { name: '코인 부스터', price: 150, emoji: '💎', effect: '1시간 코인 2배' },
                { name: '전설의 검', price: 500, emoji: '⚔️', effect: '공격력 증가' }
            ];

            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>🏪 상점</h2>
                    <p>코인: ${gameState.coins}💰</p>
                    <ul>
                        ${shopItems.map((item, index) => `
                            <li>
                                ${item.emoji} ${item.name} - ${item.price}코인
                                <br><button ${gameState.coins >= item.price ? '' : 'disabled'} onclick="buyItemFromModal(${index}, '${item.name}', ${item.price}, '${item.effect}', '${item.emoji}')">
                                    ${gameState.coins >= item.price ? '구매' : '부족'}
                                </button>
                            </li>
                        `).join('')}
                    </ul>
                    <button onclick="closeModal()">닫기</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function buyItemFromModal(index, name, price, effect, emoji) {
            buyItem({ name, price, effect, emoji });
            closeModal();
        }

        function buyItem(item) {
            if (gameState.coins >= item.price) {
                gameState.coins -= item.price;
                log(`🛒 ${item.name} 구매`, 'success');
                log(`💡 ${item.effect}`, 'info');

                switch (item.name) {
                    case '체력 물약':
                        gameState.currentHp = Math.min(gameState.maxHp, gameState.currentHp + 15);
                        break;
                    case '경험치 물약':
                        gameState.exp += 25;
                        if (gameState.exp >= 100) levelUp();
                        break;
                    case '행운의 부적':
                        isLuckyCharmActive = true;
                        log('🍀 다음 전투 승리!', 'warning');
                        break;
                    case '코인 부스터':
                        coinBoostEndTime = Date.now() + 3600000;
                        log('💎 코인 2배 시작!', 'warning');
                        break;
                    case '전설의 검':
                        attackBoost += 5;
                        log('⚔️ 공격력 증가!', 'warning');
                        break;
                }

                updateAllDisplays();
                saveGameState();
            } else {
                log('💸 코인 부족!', 'error');
            }
        }

        function showRanking() {
            const rankings = [
                { name: 'DragonMaster', level: 28, score: 18500 },
                { name: 'ShadowNinja', level: 25, score: 16200 },
                { name: 'FireWizard', level: 23, score: 14800 },
                { name: playerName, level: gameState.level, score: gameState.totalScore }
            ].sort((a, b) => b.score - a.score);

            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>🏆 랭킹</h2>
                    <ul>
                        ${rankings.map((player, index) => {
                            const rank = index + 1;
                            const crown = rank === 1 ? '👑' : rank === 2 ? '🥈' : rank === 3 ? '🥉' : `${rank}.`;
                            const isMe = player.name === playerName ? ' ⭐' : '';
                            return `
                                <li>
                                    ${crown} ${player.name}${isMe}
                                    <br>Lv.${player.level} | ${player.score.toLocaleString()}점
                                </li>
                            `;
                        }).join('')}
                    </ul>
                    <button onclick="closeModal()">닫기</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showModal(message, type = 'info') {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2 class="log-${type}">${message}</h2>
                    <button onclick="closeModal()">확인</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function closeModal() {
            const modal = document.querySelector('.modal');
            if (modal) modal.remove();
        }

        function showStats() {
            log('📊 통계', 'info');
            log(`👤 ${playerName}`, 'info');
            log(`⭐ Lv.${gameState.level} (${getLevelTitle()})`, 'info');
            log(`💎 ${gameState.totalScore.toLocaleString()}점`, 'info');
            log(`💰 ${gameState.coins.toLocaleString()}코인`, 'info');
            log(`📝 기록 ${gameState.deedsRecorded}개`, 'info');
            log(`❤️ HP ${gameState.currentHp}/${gameState.maxHp}`, 'info');
        }

        function getLevelTitle() {
            for (let level of Object.keys(levelTitles).sort((a, b) => b - a)) {
                if (gameState.level >= parseInt(level)) return levelTitles[level];
            }
            return levelTitles[1];
        }

        function getCharacterAvatar() {
            if (gameState.level >= 30) return '👑';
            if (gameState.level >= 25) return '⚡';
            if (gameState.level >= 20) return '🔥';
            if (gameState.level >= 15) return '⚔️';
            if (gameState.level >= 10) return '🛡️';
            if (gameState.level >= 5) return '🗡️';
            return '🧙‍♂️';
        }

        function updateAllDisplays() {
            document.getElementById('player-name').textContent = playerName;
            document.getElementById('player-title').textContent = getLevelTitle();
            document.getElementById('player-avatar').textContent = getCharacterAvatar();
            document.getElementById('header-coins').textContent = gameState.coins.toLocaleString();
            document.getElementById('header-score').textContent = gameState.totalScore.toLocaleString();
            document.getElementById('header-level').textContent = gameState.level;
            document.getElementById('character-avatar').textContent = getCharacterAvatar();
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('level-title').textContent = getLevelTitle();
            document.getElementById('exp').textContent = gameState.exp;
            document.getElementById('exp-fill').style.width = gameState.exp + '%';
            document.getElementById('current-hp').textContent = gameState.currentHp;
            document.getElementById('max-hp').textContent = gameState.maxHp;
            document.getElementById('coins').textContent = gameState.coins.toLocaleString();
            document.getElementById('total-score').textContent = gameState.totalScore.toLocaleString();
            document.getElementById('deeds-count').textContent = gameState.deedsRecorded;
        }

        function log(message, type = 'info') {
            logs.push({ message, type });
            if (logs.length > 10) logs.shift();
            const logContainer = document.getElementById('game-log');
            logContainer.innerHTML = logs.map(log => `
                <div class="log-entry log-${log.type}">${log.message}</div>
            `).join('');
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function saveGameState() {
            localStorage.setItem('gameState', JSON.stringify(gameState));
        }

        setInterval(() => {
            if (playerName) {
                saveGameState();
                log('💾 자동 저장', 'info');
            }
        }, 30000);
    </script>
</body>
</html>
