<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í´ë˜ì‹œ ë¡œì–„ ì½”ì¸ RPG</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bangers&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Bangers', cursive;
        }

        body {
            background: url('https://clashroyale.com/images/backgrounds/arena.jpg') no-repeat center/cover fixed;
            min-height: 100vh;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        /* Nickname Screen */
        .nickname-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .nickname-container {
            background: linear-gradient(145deg, #1e3a5f, #2c5282);
            border: 4px solid #ffd700;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
            max-width: 350px;
            width: 90%;
        }

        .game-logo {
            font-size: 2.2em;
            color: #ffd700;
            text-shadow: 0 0 8px #ff6b35;
            margin-bottom: 10px;
        }

        .game-subtitle {
            font-size: 1em;
            color: #e0e7ff;
            margin-bottom: 15px;
        }

        .nickname-input {
            width: 100%;
            padding: 10px;
            font-size: 14px;
            border: 3px solid #3498db;
            border-radius: 8px;
            background: #fff;
            color: #2c3e50;
            text-align: center;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }

        .nickname-input:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 8px #ffd700;
        }

        .start-btn {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            border: none;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(247, 147, 30, 0.5);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .start-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(247, 147, 30, 0.7);
        }

        /* Top Header */
        .top-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(180deg, #1e3a5f, #2c5282);
            padding: 8px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            border-bottom: 3px solid #ffd700;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .player-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            border: 3px solid #ffd700;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }

        .player-details h3 {
            font-size: 1em;
            color: #ffd700;
        }

        .player-title {
            font-size: 0.8em;
            color: #bdc3c7;
        }

        .resources {
            display: flex;
            gap: 8px;
        }

        .resource-item {
            background: linear-gradient(45deg, #8e44ad, #9b59b6);
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 0.8em;
            border: 2px solid #fff3;
        }

        .resource-icon {
            font-size: 1em;
        }

        /* Game Container */
        .game-container {
            margin-top: 70px;
            padding: 10px;
            max-width: 900px;
            width: 100%;
        }

        /* Card Styles */
        .game-card {
            background: linear-gradient(145deg, #2c5282, #1e3a5f);
            border: 3px solid #ffd700;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s;
        }

        .game-card:hover {
            transform: translateY(-2px);
        }

        .card-title {
            font-size: 1.3em;
            color: #ffd700;
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 0 0 5px #ff6b35;
        }

        /* Character Panel */
        .character-section {
            text-align: center;
        }

        .character-avatar-large {
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            border: 4px solid #ffd700;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            margin: 0 auto 15px;
        }

        .level-display {
            background: linear-gradient(45deg, #3498db, #2980b9);
            border-radius: 8px;
            padding: 8px;
            margin-bottom: 10px;
            border: 2px solid #ffd700;
        }

        .level-text {
            font-size: 1em;
            font-weight: 400;
        }

        .progress-bar {
            background: #2c3e50;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            border: 1px solid #fff3;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            transition: width 0.5s ease;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .stat-item {
            background: #2c5282;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #fff3;
        }

        .stat-icon {
            font-size: 1.2em;
        }

        .stat-value {
            font-size: 1em;
            color: #ffd700;
        }

        /* Action Panel */
        .deed-input-section {
            margin-bottom: 10px;
        }

        .deed-input-container {
            display: flex;
            gap: 8px;
        }

        .deed-input {
            flex: 1;
            padding: 8px;
            font-size: 13px;
            border: 2px solid #3498db;
            border-radius: 6px;
            background: #fff;
            color: #2c3e50;
        }

        .deed-input:focus {
            outline: none;
            border-color: #ffd700;
        }

        .cr-button {
            padding: 8px 12px;
            font-size: 13px;
            border: none;
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .cr-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.5);
        }

        .btn-record { background: linear-gradient(45deg, #27ae60, #2ecc71); }
        .btn-battle { background: linear-gradient(45deg, #e74c3c, #c0392b); }
        .btn-shop { background: linear-gradient(45deg, #f39c12, #e67e22); }
        .btn-ranking { background: linear-gradient(45deg, #9b59b6, #8e44ad); }
        .btn-stats { background: linear-gradient(45deg, #34495e, #2c3e50); }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        /* Battle Arena */
        .battle-arena {
            text-align: center;
            padding: 15px;
        }

        .arena-enemy {
            font-size: 4em;
            margin: 15px 0;
        }

        .arena-description {
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        /* Game Log */
        .game-log {
            background: #2c3e50;
            border-radius: 8px;
            padding: 10px;
            max-height: 150px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.8em;
        }

        .log-entry {
            padding: 4px 8px;
            margin-bottom: 4px;
            border-radius: 4px;
            border-left: 2px solid;
        }

        .log-success { border-left-color: #2ecc71; color: #2ecc71; }
        .log-error { border-left-color: #e74c3c; color: #e74c3c; }
        .log-warning { border-left-color: #f39c12; color: #f39c12; }
        .log-info { border-left-color: #3498db; color: #3498db; }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .modal-content {
            background: linear-gradient(145deg, #2c5282, #1e3a5f);
            border: 3px solid #ffd700;
            border-radius: 12px;
            padding: 15px;
            max-width: 300px;
            width: 90%;
            text-align: center;
        }

        .modal-content h2 {
            color: #ffd700;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .modal-content ul {
            list-style: none;
            padding: 0;
            font-size: 0.9em;
        }

        .modal-content li {
            margin: 8px 0;
        }

        .modal-content button {
            padding: 8px 12px;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            border: none;
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
        }

        .modal-content button:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .game-container { padding: 8px; }
            .stats-grid { grid-template-columns: 1fr; }
            .button-grid { grid-template-columns: 1fr; }
            .deed-input-container { flex-direction: column; }
            .resources { flex-direction: column; gap: 6px; }
            .nickname-container { padding: 20px; max-width: 300px; }
            .game-logo { font-size: 1.8em; }
            .modal-content { max-width: 250px; }
        }
    </style>
</head>
<body>
    <!-- Nickname Screen -->
    <div class="nickname-screen" id="nickname-screen">
        <div class="nickname-container">
            <div class="game-logo">âš”ï¸ ì½”ì¸ RPG</div>
            <div class="game-subtitle">í´ë˜ì‹œ ë¡œì–„ ì—ë””ì…˜</div>
            <input type="text" class="nickname-input" id="nickname-input" placeholder="ë‹‰ë„¤ì„ (3-12ì)" maxlength="12" aria-label="ë‹‰ë„¤ì„ ì…ë ¥">
            <button class="start-btn" onclick="startGame()" aria-label="ê²Œì„ ì‹œì‘">ê²Œì„ ì‹œì‘</button>
        </div>
    </div>

    <!-- Top Header -->
    <div class="top-header" id="top-header" style="display: none;">
        <div class="player-info">
            <div class="player-avatar" id="player-avatar">ğŸ‘‘</div>
            <div class="player-details">
                <h3 id="player-name">í”Œë ˆì´ì–´</h3>
                <div class="player-title" id="player-title">ì´ˆë³´ ëª¨í—˜ê°€</div>
            </div>
        </div>
        <div class="resources">
            <div class="resource-item">
                <span class="resource-icon">ğŸ’°</span>
                <span id="header-coins">10</span>
            </div>
            <div class="resource-item">
                <span class="resource-icon">ğŸ’</span>
                <span id="header-score">0</span>
            </div>
            <div class="resource-item">
                <span class="resource-icon">âš¡</span>
                <span id="header-level">1</span>
            </div>
        </div>
    </div>

    <!-- Game Container -->
    <div class="game-container" id="game-container" style="display: none;">
        <!-- Character Panel -->
        <div class="game-card">
            <div class="card-title">ğŸ›ï¸ ìºë¦­í„°</div>
            <div class="character-section">
                <div class="character-avatar-large" id="character-avatar">ğŸ‘‘</div>
                <div class="level-display">
                    <div class="level-text">ë ˆë²¨ <span id="level">1</span> - <span id="level-title">ì´ˆë³´ ëª¨í—˜ê°€</span></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="exp-fill" style="width: 0%"></div>
                    </div>
                    <div style="margin-top: 5px; font-size: 0.8em;">EXP: <span id="exp">0</span>/100</div>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-icon">â¤ï¸</div>
                        <div>ì²´ë ¥</div>
                        <div class="stat-value"><span id="current-hp">30</span>/<span id="max-hp">30</span></div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">ğŸ’°</div>
                        <div>ì½”ì¸</div>
                        <div class="stat-value" id="coins">10</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">ğŸ’</div>
                        <div>ì´ì </div>
                        <div class="stat-value" id="total-score">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">ğŸ“</div>
                        <div>ê¸°ë¡</div>
                        <div class="stat-value" id="deeds-count">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Panel -->
        <div class="game-card">
            <div class="card-title">âœ… ì˜í•œ ì¼</div>
            <div class="deed-input-section">
                <div class="deed-input-container">
                    <input type="text" class="deed-input" id="good-deed" placeholder="ì˜í•œ ì¼ ì…ë ¥" aria-label="ì˜í•œ ì¼ ì…ë ¥">
                    <button class="cr-button btn-record" onclick="recordGoodDeed()" aria-label="ê¸°ë¡">ê¸°ë¡</button>
                </div>
                <div style="font-size: 11px; opacity: 0.8; text-align: center; margin-top: 8px;">
                    ğŸ’¡ ìš´ë™, ê³µë¶€, ë„ì›€ í‚¤ì›Œë“œ ë³´ë„ˆìŠ¤!
                </div>
            </div>
            <div class="button-grid">
                <button class="cr-button btn-battle" onclick="startBattle()" aria-label="ë˜ì „">âš”ï¸ ë˜ì „</button>
                <button class="cr-button btn-shop" onclick="showShop()" aria-label="ìƒì ">ğŸª ìƒì </button>
                <button class="cr-button btn-ranking" onclick="showRanking()" aria-label="ë­í‚¹">ğŸ† ë­í‚¹</button>
                <button class="cr-button btn-stats" onclick="showStats()" aria-label="í†µê³„">ğŸ“Š í†µê³„</button>
            </div>
        </div>

        <!-- Battle Arena -->
        <div class="game-card">
            <div class="card-title">âš”ï¸ ì•„ë ˆë‚˜</div>
            <div class="battle-arena">
                <div class="arena-enemy">ğŸ°</div>
                <div class="arena-description">ë˜ì „ì—ì„œ ë³´ë¬¼ì„ íšë“!</div>
                <button class="cr-button btn-battle" onclick="startBattle()" aria-label="ì „íˆ¬">âš”ï¸ ì „íˆ¬</button>
            </div>
        </div>

        <!-- Game Log -->
        <div class="game-card">
            <div class="card-title">ğŸ“œ ë¡œê·¸</div>
            <div class="game-log" id="game-log">
                <div class="log-entry log-info">ğŸ‰ í´ë˜ì‹œ ë¡œì–„ ì½”ì¸ RPG!</div>
                <div class="log-entry log-success">ğŸ’° 10ì½”ì¸ íšë“!</div>
            </div>
        </div>
    </div>

    <script>
        let playerName = '';
        let gameState = {
            level: 1,
            exp: 0,
            maxHp: 30,
            currentHp: 30,
            coins: 10,
            totalScore: 0,
            deedsRecorded: 0,
            playerName: ''
        };
        let logs = [];
        let battleTimer = null;
        let isLuckyCharmActive = false;
        let coinBoostEndTime = 0;
        let attackBoost = 0;

        const levelTitles = {
            1: "ì´ˆë³´ ëª¨í—˜ê°€", 3: "ê²¬ìŠµ ì „ì‚¬", 5: "ìš©ê°í•œ ê¸°ì‚¬",
            8: "ìˆ™ë ¨ëœ ì „ì‚¬", 12: "ë² í…Œë‘ ìš©ì‚¬", 15: "ì •ì˜ˆ ì±”í”¼ì–¸",
            20: "ì „ì„¤ì˜ ì˜ì›…", 25: "ë§ˆìŠ¤í„° ì›Œë¦¬ì–´", 30: "ì–¼í‹°ë°‹ ë ˆì „ë“œ"
        };

        document.addEventListener('DOMContentLoaded', () => {
            // Always show nickname screen on load, even with saved state
            document.getElementById('nickname-screen').style.display = 'flex';
            document.getElementById('top-header').style.display = 'none';
            document.getElementById('game-container').style.display = 'none';

            const savedState = localStorage.getItem('gameState');
            if (savedState) {
                gameState = JSON.parse(savedState);
                playerName = gameState.playerName || '';
                if (playerName) {
                    document.getElementById('nickname-input').value = playerName;
                }
            }

            document.getElementById('nickname-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') startGame();
            });

            document.getElementById('good-deed').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') recordGoodDeed();
            });
        });

        function startGame() {
            const nickname = document.getElementById('nickname-input').value.trim();
            if (!nickname) {
                showModal('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error');
                return;
            }
            if (nickname.length < 3) {
                showModal('ë‹‰ë„¤ì„ì„ ë” ê¸¸ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”! (3-12ì)', 'error');
                return;
            }
            if (nickname.length > 12) {
                showModal('ë‹‰ë„¤ì„ì€ 12ìë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!', 'error');
                return;
            }

            playerName = nickname;
            gameState.playerName = playerName;
            document.getElementById('nickname-screen').style.display = 'none';
            document.getElementById('top-header').style.display = 'flex';
            document.getElementById('game-container').style.display = 'block';
            updateAllDisplays();
            saveGameState();
            log(`ğŸ‰ ${playerName}ë‹˜, ëª¨í—˜ ì‹œì‘!`, 'success');
        }

        function recordGoodDeed() {
            const input = document.getElementById('good-deed');
            const deed = input.value.trim();
            if (!deed) {
                log('ì˜í•œ ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error');
                return;
            }

            let baseCoins = 15;
            let bonusCoins = 0;
            const bonusKeywords = {
                ìš´ë™: ['ìš´ë™', 'ì¡°ê¹…', 'ë‹¬ë¦¬ê¸°', 'í—¬ìŠ¤', 'ìš”ê°€', 'ìˆ˜ì˜', 'ì‚°ì±…'],
                ê³µë¶€: ['ê³µë¶€', 'ë…ì„œ', 'í•™ìŠµ', 'ê°•ì˜', 'ì‹œí—˜', 'ê³¼ì œ', 'ì±…'],
                ë„ì›€: ['ë„ì›€', 'ë´‰ì‚¬', 'ê¸°ë¶€', 'ì¹œì ˆ', 'ë°°ë ¤', 'ì²­ì†Œ', 'ì„¤ê±°ì§€']
            };

            let bonusCategories = [];
            for (const [category, words] of Object.entries(bonusKeywords)) {
                for (const word of words) {
                    if (deed.includes(word)) {
                        bonusCoins += 10;
                        bonusCategories.push(category);
                        break;
                    }
                }
            }

            let totalCoins = baseCoins + bonusCoins;
            if (coinBoostEndTime > Date.now()) {
                totalCoins *= 2;
                log('ğŸ’ ì½”ì¸ 2ë°°!', 'warning');
            }

            const earnedExp = Math.floor(totalCoins / 3);
            gameState.coins += totalCoins;
            gameState.exp += earnedExp;
            gameState.deedsRecorded++;
            gameState.totalScore += totalCoins * 2;

            if (gameState.exp >= 100) levelUp();

            log(`ğŸ“ "${deed}" ê¸°ë¡`, 'success');
            log(`ğŸ’° +${totalCoins}ì½”ì¸, âœ¨ +${earnedExp}EXP`, 'info');
            if (bonusCategories.length) log(`ğŸ‰ ${bonusCategories.join(', ')} ë³´ë„ˆìŠ¤`, 'warning');

            input.value = '';
            updateAllDisplays();
            saveGameState();
        }

        function levelUp() {
            const levelsGained = Math.floor(gameState.exp / 100);
            gameState.level += levelsGained;
            gameState.exp %= 100;
            const hpIncrease = levelsGained * 8;
            gameState.maxHp += hpIncrease;
            gameState.currentHp = gameState.maxHp;

            log(`ğŸ‰ ë ˆë²¨ ${gameState.level}!`, 'success');
            log(`â¤ï¸ HP +${hpIncrease}`, 'info');

            const levelBonus = levelsGained * 25;
            gameState.coins += levelBonus;
            gameState.totalScore += levelBonus * 3;
            log(`ğŸ’° +${levelBonus}ì½”ì¸`, 'warning');

            updateAllDisplays();
            saveGameState();
        }

        function startBattle() {
            if (battleTimer) clearTimeout(battleTimer);

            const enemies = [
                { name: 'ê³ ë¸”ë¦°', emoji: 'ğŸ‘¹', minDamage: 5, maxDamage: 12, minReward: 8, maxReward: 18 },
                { name: 'ì˜¤í¬', emoji: 'ğŸ§Œ', minDamage: 8, maxDamage: 15, minReward: 12, maxReward: 25 },
                { name: 'ìŠ¤ì¼ˆë ˆí†¤', emoji: 'ğŸ’€', minDamage: 3, maxDamage: 10, minReward: 5, maxReward: 15 },
                { name: 'ë“œë˜ê³¤', emoji: 'ğŸ²', minDamage: 15, maxDamage: 25, minReward: 30, maxReward: 50 },
                { name: 'ë§ˆë²•ì‚¬', emoji: 'ğŸ§™â€â™‚ï¸', minDamage: 10, maxDamage: 20, minReward: 20, maxReward: 35 }
            ];

            const enemy = enemies[Math.floor(Math.random() * enemies.length)];
            const baseDamage = Math.floor(Math.random() * (enemy.maxDamage - enemy.minDamage + 1)) + enemy.minDamage;
            const damage = Math.max(0, baseDamage - attackBoost);
            let coinReward = Math.floor(Math.random() * (enemy.maxReward - enemy.minReward + 1)) + enemy.minReward;
            const expReward = Math.floor(coinReward / 2);

            if (coinBoostEndTime > Date.now()) coinReward *= 2;

            log(`âš”ï¸ ${enemy.emoji} ${enemy.name} ì „íˆ¬`, 'warning');

            battleTimer = setTimeout(() => {
                const win = isLuckyCharmActive || Math.random() > 0.2;
                if (win) {
                    log(`ğŸ’¥ ${enemy.name} ê²©íŒŒ!`, 'success');
                    log(`ğŸ† +${coinReward}ì½”ì¸, +${expReward}EXP`, 'success');
                    gameState.coins += coinReward;
                    gameState.exp += expReward;
                    gameState.totalScore += coinReward * 3;
                    if (gameState.exp >= 100) levelUp();
                } else {
                    const lostHp = Math.floor(Math.random() * 10) + 5;
                    gameState.currentHp = Math.max(0, gameState.currentHp - lostHp);
                    log(`ğŸ’” ${enemy.name} íŒ¨ë°°, HP -${lostHp}`, 'error');
                    if (gameState.currentHp <= 0) {
                        log(`ğŸ˜µ ì²´ë ¥ ì†Œì§„! 5ì´ˆ í›„ ë¶€í™œ`, 'error');
                        battleTimer = setTimeout(() => {
                            gameState.currentHp = Math.floor(gameState.maxHp * 0.5);
                            log(`ğŸŒŸ ë¶€í™œ! HP íšŒë³µ`, 'info');
                            updateAllDisplays();
                            saveGameState();
                        }, 5000);
                    }
                }

                if (isLuckyCharmActive) {
                    isLuckyCharmActive = false;
                    log('ğŸ€ í–‰ìš´ì˜ ë¶€ì  ì¢…ë£Œ', 'info');
                }

                updateAllDisplays();
                saveGameState();
                battleTimer = null;
            }, 1500);
        }

        function showShop() {
            const shopItems = [
                { name: 'ì²´ë ¥ ë¬¼ì•½', price: 30, emoji: 'ğŸ§ª', effect: 'HP +15' },
                { name: 'ê²½í—˜ì¹˜ ë¬¼ì•½', price: 50, emoji: 'âœ¨', effect: 'EXP +25' },
                { name: 'í–‰ìš´ì˜ ë¶€ì ', price: 100, emoji: 'ğŸ€', effect: 'ë‹¤ìŒ ì „íˆ¬ ìŠ¹ë¦¬' },
                { name: 'ì½”ì¸ ë¶€ìŠ¤í„°', price: 150, emoji: 'ğŸ’', effect: '1ì‹œê°„ ì½”ì¸ 2ë°°' },
                { name: 'ì „ì„¤ì˜ ê²€', price: 500, emoji: 'âš”ï¸', effect: 'ê³µê²©ë ¥ ì¦ê°€' }
            ];

            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>ğŸª ìƒì </h2>
                    <p>ì½”ì¸: ${gameState.coins}ğŸ’°</p>
                    <ul>
                        ${shopItems.map((item, index) => `
                            <li>
                                ${item.emoji} ${item.name} - ${item.price}ì½”ì¸
                                <br><button ${gameState.coins >= item.price ? '' : 'disabled'} onclick="buyItemFromModal(${index}, '${item.name}', ${item.price}, '${item.effect}', '${item.emoji}')">
                                    ${gameState.coins >= item.price ? 'êµ¬ë§¤' : 'ë¶€ì¡±'}
                                </button>
                            </li>
                        `).join('')}
                    </ul>
                    <button onclick="closeModal()">ë‹«ê¸°</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function buyItemFromModal(index, name, price, effect, emoji) {
            buyItem({ name, price, effect, emoji });
            closeModal();
        }

        function buyItem(item) {
            if (gameState.coins >= item.price) {
                gameState.coins -= item.price;
                log(`ğŸ›’ ${item.name} êµ¬ë§¤`, 'success');
                log(`ğŸ’¡ ${item.effect}`, 'info');

                switch (item.name) {
                    case 'ì²´ë ¥ ë¬¼ì•½':
                        gameState.currentHp = Math.min(gameState.maxHp, gameState.currentHp + 15);
                        break;
                    case 'ê²½í—˜ì¹˜ ë¬¼ì•½':
                        gameState.exp += 25;
                        if (gameState.exp >= 100) levelUp();
                        break;
                    case 'í–‰ìš´ì˜ ë¶€ì ':
                        isLuckyCharmActive = true;
                        log('ğŸ€ ë‹¤ìŒ ì „íˆ¬ ìŠ¹ë¦¬!', 'warning');
                        break;
                    case 'ì½”ì¸ ë¶€ìŠ¤í„°':
                        coinBoostEndTime = Date.now() + 3600000;
                        log('ğŸ’ ì½”ì¸ 2ë°° ì‹œì‘!', 'warning');
                        break;
                    case 'ì „ì„¤ì˜ ê²€':
                        attackBoost += 5;
                        log('âš”ï¸ ê³µê²©ë ¥ ì¦ê°€!', 'warning');
                        break;
                }

                updateAllDisplays();
                saveGameState();
            } else {
                log('ğŸ’¸ ì½”ì¸ ë¶€ì¡±!', 'error');
            }
        }

        function showRanking() {
            const rankings = [
                { name: 'DragonMaster', level: 28, score: 18500 },
                { name: 'ShadowNinja', level: 25, score: 16200 },
                { name: 'FireWizard', level: 23, score: 14800 },
                { name: playerName, level: gameState.level, score: gameState.totalScore }
            ].sort((a, b) => b.score - a.score);

            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>ğŸ† ë­í‚¹</h2>
                    <ul>
                        ${rankings.map((player, index) => {
                            const rank = index + 1;
                            const crown = rank === 1 ? 'ğŸ‘‘' : rank === 2 ? 'ğŸ¥ˆ' : rank === 3 ? 'ğŸ¥‰' : `${rank}.`;
                            const isMe = player.name === playerName ? ' â­' : '';
                            return `
                                <li>
                                    ${crown} ${player.name}${isMe}
                                    <br>Lv.${player.level} | ${player.score.toLocaleString()}ì 
                                </li>
                            `;
                        }).join('')}
                    </ul>
                    <button onclick="closeModal()">ë‹«ê¸°</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showModal(message, type = 'info') {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2 class="log-${type}">${message}</h2>
                    <button onclick="closeModal()">í™•ì¸</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function closeModal() {
            const modal = document.querySelector('.modal');
            if (modal) modal.remove();
        }

        function showStats() {
            log('ğŸ“Š í†µê³„', 'info');
            log(`ğŸ‘¤ ${playerName}`, 'info');
            log(`â­ Lv.${gameState.level} (${getLevelTitle()})`, 'info');
            log(`ğŸ’ ${gameState.totalScore.toLocaleString()}ì `, 'info');
            log(`ğŸ’° ${gameState.coins.toLocaleString()}ì½”ì¸`, 'info');
            log(`ğŸ“ ê¸°ë¡ ${gameState.deedsRecorded}ê°œ`, 'info');
            log(`â¤ï¸ HP ${gameState.currentHp}/${gameState.maxHp}`, 'info');
        }

        function getLevelTitle() {
            for (let level of Object.keys(levelTitles).sort((a, b) => b - a)) {
                if (gameState.level >= parseInt(level)) return levelTitles[level];
            }
            return levelTitles[1];
        }

        function getCharacterAvatar() {
            if (gameState.level >= 30) return 'ğŸ‘‘';
            if (gameState.level >= 25) return 'âš¡';
            if (gameState.level >= 20) return 'ğŸ”¥';
            if (gameState.level >= 15) return 'âš”ï¸';
            if (gameState.level >= 10) return 'ğŸ›¡ï¸';
            if (gameState.level >= 5) return 'ğŸ—¡ï¸';
            return 'ğŸ§™â€â™‚ï¸';
        }

        function updateAllDisplays() {
            document.getElementById('player-name').textContent = playerName;
            document.getElementById('player-title').textContent = getLevelTitle();
            document.getElementById('player-avatar').textContent = getCharacterAvatar();
            document.getElementById('header-coins').textContent = gameState.coins.toLocaleString();
            document.getElementById('header-score').textContent = gameState.totalScore.toLocaleString();
            document.getElementById('header-level').textContent = gameState.level;
            document.getElementById('character-avatar').textContent = getCharacterAvatar();
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('level-title').textContent = getLevelTitle();
            document.getElementById('exp').textContent = gameState.exp;
            document.getElementById('exp-fill').style.width = gameState.exp + '%';
            document.getElementById('current-hp').textContent = gameState.currentHp;
            document.getElementById('max-hp').textContent = gameState.maxHp;
            document.getElementById('coins').textContent = gameState.coins.toLocaleString();
            document.getElementById('total-score').textContent = gameState.totalScore.toLocaleString();
            document.getElementById('deeds-count').textContent = gameState.deedsRecorded;
        }

        function log(message, type = 'info') {
            logs.push({ message, type });
            if (logs.length > 10) logs.shift();
            const logContainer = document.getElementById('game-log');
            logContainer.innerHTML = logs.map(log => `
                <div class="log-entry log-${log.type}">${log.message}</div>
            `).join('');
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function saveGameState() {
            localStorage.setItem('gameState', JSON.stringify(gameState));
        }

        setInterval(() => {
            if (playerName) {
                saveGameState();
                log('ğŸ’¾ ìë™ ì €ì¥', 'info');
            }
        }, 30000);
    </script>
</body>
</html>
